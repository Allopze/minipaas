version: '3.8'

services:
  minipaas:
    build: .
    container_name: minipaas
    restart: unless-stopped
    # IMPORTANTE: Usamos 'host' para que las aplicaciones desplegadas en puertos dinámicos (5200, 5201...)
    # sean accesibles directamente desde la IP del servidor sin necesidad de mapear rangos de puertos gigantes.
    # Esto funciona nativamente en Linux (Ubuntu).
    network_mode: host
    
    environment:
      - NODE_ENV=production
      # IMPORTANT: Set a strong secret for JWT tokens (generate with: openssl rand -hex 64)
      - JWT_SECRET=${JWT_SECRET:?JWT_SECRET environment variable is required}
    
    volumes:
      # Persistencia de datos
      - ./data:/app/data
      - ./app-data:/app/app-data    # Datos persistentes de las apps (uploads, DBs, etc.)
      - ./apps:/app/apps
      - ./logs:/app/logs
      - ./backups:/app/backups
      - ./public/uploads:/app/public/uploads
      
    # Configuración de logs para el contenedor principal
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
